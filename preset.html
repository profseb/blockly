<!DOCTYPE html>
<html>
<head>
	<title>Blockly Test</title>
</head>
<body>

	<script src="../blockly_src/blockly_compressed.js"></script>
	<script src="../blockly_src/javascript_compressed.js"></script>
	<script src="../blockly_src/blocks_compressed.js"></script>
	<script src="../blockly_src/msg/js/pt-br.js"></script>	

	<script type="text/javascript">
		Blockly.Blocks['string_length'] = {
		  init: function() {
		    this.jsonInit({
		      "message0": 'tamanho de %1',
		      "args0": [
		        {
		          "type": "input_value",
		          "name": "VALUE",
		          "check": "String"
		        }
		      ],
		      "output": "Number",
		      "colour": 120,
		      "tooltip": "Returns number of letters in the provided text.",
		      "helpUrl": "http://www.w3schools.com/jsref/jsref_length_string.asp"
		    });
		  }
		};
	</script>

	<div id="blocklyDiv" style="height: 480px; width: 800px;float: left"></div>

	<xml id="toolbox" style="display: none">	  
		<block type="text"></block>
		<block type="text_print"></block>		
		<block type="text_changeCase"></block>		
		<block type="string_length"></block>		
	</xml>

	<xml id="startBlocks" style="display: none">
    <block type="text_print">
     	<value name="TEXT">
        <block type="text">
          <field name="TEXT">Sebasti√£o</field>
        </block>
    </block>
     <block type="text_print" x="10" y="60">
     	<value name="TEXT">
        <block type="string_length">
        	<value name="VALUE">
        	<block type="text">
          		<field name="TEXT">Texto</field>
      		</block>
        </block>
    </block>
  	</xml>

	<div style="float:left">
		<textarea style="float: left" id="textarea" rows="10" cols="40"></textarea>
		<br />
		<input type="button" value="Executar" id="exec" />
	</div>

	<script>
	  

	  Blockly.JavaScript['string_length'] = function(block) {
  // String or array length.
  var argument0 = Blockly.JavaScript.valueToCode(block, 'VALUE',
      Blockly.JavaScript.ORDER_FUNCTION_CALL) || '\'\'';
  return [argument0 + '.length', Blockly.JavaScript.ORDER_MEMBER];
};

	  function myUpdateFunction(event) {
		  var code = Blockly.JavaScript.workspaceToCode(workspace);
		  document.getElementById('textarea').value = code;
		}

	document.getElementById("exec").addEventListener("click",execute);

	function execute(event) {
		  
		  code = document.getElementById('textarea').value;
		  eval(code);

		}

		var workspace = Blockly.inject('blocklyDiv',
	      {toolbox: document.getElementById('toolbox')});

		Blockly.Xml.domToWorkspace(document.getElementById('startBlocks'),
                               workspace);

		workspace.addChangeListener(myUpdateFunction);


	</script>

	


</body>
</html>